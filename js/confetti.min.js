const canvas = document.getElementById('confetti-canvas');
const ctx = canvas.getContext('2d');

function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
resizeCanvas();
window.addEventListener('resize', resizeCanvas);

const confettiCount = 200;
const gravity = 0.2;
const wind = 0.02;
const colors = ['#009739', '#00C06B', '#66FFB3'];

const confetti = [];

function random(min, max) {
  return Math.random() * (max - min) + min;
}

function createConfettiPiece() {
  return {
    x: random(0, canvas.width),
    y: random(-canvas.height, 0),
    size: random(5, 8),
    color: colors[Math.floor(Math.random() * colors.length)],
    tilt: random(-10, 10),
    tiltAngle: 0,
    tiltAngleIncrement: random(0.01, 0.05),
    dx: random(-wind, wind),
    dy: random(2, 4),
    rotation: random(0, 2 * Math.PI)
  };
}

function initConfetti() {
  for (let i = 0; i < confettiCount; i++) {
    confetti.push(createConfettiPiece());
  }
}

function updateConfetti() {
  for (let i = confetti.length - 1; i >= 0; i--) {
    const c = confetti[i];
    c.tiltAngle += c.tiltAngleIncrement;
    c.y += c.dy;
    c.x += c.dx;
    c.tilt = Math.sin(c.tiltAngle) * 15;

    if (c.y > canvas.height + 20) {
      confetti.splice(i, 1); // Remove da tela após cair
    }
  }
}

function drawConfetti() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  confetti.forEach((c) => {
    ctx.beginPath();
    ctx.strokeStyle = c.color;
    ctx.lineWidth = c.size;
    ctx.moveTo(c.x + c.tilt, c.y);
    ctx.lineTo(c.x, c.y + c.tilt + c.size);
    ctx.stroke();
  });
}

function animate() {
  drawConfetti();
  updateConfetti();

  if (confetti.length > 0) {
    requestAnimationFrame(animate);
  }
}

function startConfettiFall() {
  initConfetti();
  animate();
}

// Exemplo: iniciar ao carregar a página
startConfettiFall();

// Ou, para ativar por evento, chame `startConfettiFall()` após quiz/resposta/botão
